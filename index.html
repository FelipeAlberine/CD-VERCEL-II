<canvas id="rouletteCanvas" width="280" height="280" style="border-radius:50%; background:#223366;"></canvas>
<button id="spinBtn">Girar Roleta!</button>
<div id="casinoMessage" style="margin-top:10px; font-weight:bold; color:#99ffff;"></div>

<script>
  (() => {
    const canvas = document.getElementById('rouletteCanvas');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const casinoMessage = document.getElementById('casinoMessage');

    const sectors = [
      {color: '#66ff66', label: 'R$ 10', value: 10},
      {color: '#ffff66', label: 'R$ 20', value: 20},
      {color: '#ff6666', label: 'Perde Tudo', value: 0},
      {color: '#66ccff', label: 'R$ 5', value: 5},
      {color: '#ff66ff', label: 'R$ 15', value: 15},
      {color: '#cc66ff', label: 'Tente Novamente', value: -1}
    ];

    let angle = 0;
    let angularVelocity = 0;
    let spinning = false;

    function drawRoulette() {
      const cx = canvas.width / 2;
      const cy = canvas.height / 2;
      const radius = cx - 10;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const sectorAngle = (2 * Math.PI) / sectors.length;
      sectors.forEach((sector, i) => {
        const startAngle = angle + i * sectorAngle;
        const endAngle = startAngle + sectorAngle;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, radius, startAngle, endAngle);
        ctx.fillStyle = sector.color;
        ctx.fill();
        ctx.strokeStyle = '#222';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Texto
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(startAngle + sectorAngle / 2);
        ctx.textAlign = 'right';
        ctx.fillStyle = '#222';
        ctx.font = 'bold 16px Arial';
        ctx.fillText(sector.label, radius - 10, 5);
        ctx.restore();
      });

      // Desenha o ponteiro (seta no topo)
      ctx.beginPath();
      ctx.moveTo(cx, cy - radius + 5);
      ctx.lineTo(cx - 15, cy - radius + 40);
      ctx.lineTo(cx + 15, cy - radius + 40);
      ctx.closePath();
      ctx.fillStyle = '#ff4444';
      ctx.fill();

      // Círculo central
      ctx.beginPath();
      ctx.arc(cx, cy, 30, 0, 2 * Math.PI);
      ctx.fillStyle = '#444466';
      ctx.fill();
      ctx.strokeStyle = '#222';
      ctx.lineWidth = 3;
      ctx.stroke();
    }

    function animate() {
      if (!spinning) return;

      angle += angularVelocity;
      angularVelocity *= 0.97; // fricção

      if (angularVelocity < 0.002) {
        angularVelocity = 0;
        spinning = false;
        angle %= 2 * Math.PI;
        showResult();
      } else {
        requestAnimationFrame(animate);
      }

      drawRoulette();
    }

    function showResult() {
      const sectorAngle = (2 * Math.PI) / sectors.length;
      // Ajustar o ângulo para ponteiro no topo (3pi/2)
      const adjustedAngle = (3 * Math.PI / 2 - angle + 2 * Math.PI) % (2 * Math.PI);
      const index = Math.floor(adjustedAngle / sectorAngle);
      const winner = sectors[index];
      let msg = "";
      if (winner.value > 0) {
        msg = `🎉 Parabéns! Você ganhou R$${winner.value}!`;
      } else if (winner.value === 0) {
        msg = "😵 Ops! Você perdeu tudo! Tente novamente!";
      } else {
        msg = "🤷‍♂️ Tente novamente, a sorte muda!";
      }
      casinoMessage.textContent = msg;
    }

    spinBtn.addEventListener('click', () => {
      if (spinning) return;
      angularVelocity = Math.random() * 0.3 + 0.3; // velocidade inicial
      spinning = true;
      casinoMessage.textContent = "Girando... 🎲";
      animate();
    });

    drawRoulette();
  })();
</script>
